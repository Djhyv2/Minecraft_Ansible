[Unit] 
Description=Modded {{ minecraft_settings.modpack }} Minecraft Server
After=local-fs.target network.target

[Service]
WorkingDirectory=/home/{{ ansible_user }}/{{ minecraft_settings.modpack }}
Nice=5
Restart=on-failure
Type=forking

ExecStart=/usr/bin/tmux new -d -s {{ minecraft_settings.modpack }} ~/{{ minecraft_settings.modpack }}/start.sh
ExecStop=/usr/bin/tmux send -t {{ minecraft_settings.modpack }} 'Stop' Enter
ExecStop=/bin/bash -c "while ps -p $MAINPID > /dev/null; do /bin/sleep 1; done"

[Install]
WantedBy=default.target